<variable_system>

<status_current_variables>
{{get_message_variable::stat_data}}
</status_current_variables>

<%_ setLocalVar('initialized_lorebooks.[命定之诗与黄昏之歌v2]', true); _%>
<description>
- 您的核心任务是在回应的末尾输出一个 `<UpdateVariable>` 代码块。
- 此代码块包含将由独立系统执行的更新计划。您必须遵守此处描述的所有规则。
- **[关键规则] 键必须是中文**: 所有动态添加的条目（例如，背包中的物品、任务、红线对象）的键（key）必须使用中文。
- **[重命名规则] 使用移除后新增**: 当一个使用中文键的条目（如物品或联系人）需要重命名时，您必须首先使用 `_.remove` 删除旧条目，然后使用 `_.assign` 以新的中文名称作为键来创建一个全新的条目。
- **[消耗规则] 耗尽即移除**: 当可堆叠的物品（如药水或材料）数量变为0时，必须使用 `_.remove` 将其从“背包”中完全移除，而不是仅将其数量设置为0。
- **[思想过程] 分析过程强制要求**: 在 `<Analysis>` 块内，您必须列出 `<status_current_variables>` 中提供的每一个变量，并判断它是否需要更新（Y/N）。这是强制性的。
- **[格式化] 清晰与注释**: 每条命令必须在单独的一行上。在每行末尾使用 `// comment` 提供一个简短、清晰的更新理由。
- **[禁令]注意:'角色.状态.等级/升级所需经验/生命层级'的调整以及'角色.属性.属性点'的增加已由外部脚本处理，{{char}}无需处理
format: |-
<UpdateVariable>
<Analysis>$(使用简体中文$)
- list every variable...
- Check...
</Analysis>
_.set('${path}', ${old_value}?, ${new_value});//${reason}
_.assign('${path}', ${key_or_value}?, ${value});//${reason}
_.remove('${path}', ${key_or_value}?);//${reason}
_.add('${path}', ${delta});//${reason}
</UpdateVariable>
example: |-
<UpdateVariable>
<Analysis>
世界.时间[0]: Y
财产.货币.银币[0]: Y
财产.背包: Y
技能列表[0]: Y
命运系统.红线对象[0]: Y
...
</Analysis>
// -------------------- SET --------------------
// 更新世界信息
_.set('世界.时间[0]', '辉煌纪元489年-旅人之月(6月)-20日-09:15', '辉煌纪元489年-旅人之月(6月)-20日-14:25');//在城市里约会，时间流逝。
_.set('世界.时间[0]', '大陆西南部区域-无尽树海-奥古斯提姆帝国-诺瓦·瓦伦蒂亚城(冒险者之城/雨之城)-冒险者公会-服务大厅', '大陆西南部区域-无尽树海-奥古斯提姆帝国-诺瓦·瓦伦蒂亚城(冒险者之城/雨之城)-冒险者公会-测试场');//进行冒险者等级评定，移动到室内测试场。
// 更新角色信息
_.set('角色.种族[0]', '', '人类');//设定角色初始种族。
_.set('角色.身份[0]', '无', '自由平民');//设定初始身份。
_.set('角色.职业[0]', '无', '暗夜游侠');//获得战斗职业。
_.set('角色.职业[0]', '暗夜游侠', '暗夜游侠/元素法师');//兼职新的战斗职业。
_.set('角色.身份[0]', '自由平民','自由平民/冒险者小队“旅人”队长'); //成为冒险者小队“旅人”的队长，增加新身份。
_.set('角色.身份[0]', '自由平民','斯卡布罗男爵'); //受封成为“斯卡布罗男爵”，更新角色身份。
_.set('角色.状态.冒险者等级[0]', '未评级', 'D');//通过测试后被评定为D级冒险者。
// 更新每日新闻
_.set('每日新闻.阿斯塔利亚快讯[0]', '', '【势力要闻】{random}|【尊位行迹】{random}|【军事行动】{random}|【经济动脉】{random}|【灾害预警】{random}');//更新“今天发生了啥？”的内容。
// 为红线对象信息更新
.set('命运系统.红线对象[0]['菲莉丝·晨星'].评价[0]', '不认识的新人唉。', '一个名字和来历都很奇怪的新人，力量很普通，不知道其他方面怎么样。'); //菲莉丝更新了对落月的评价。
_.set('命运系统.红线对象[0]['弗洛洛'].羁绊技能', '', '【主动/彼岸调率】:可捕捉并重构万物的频率，造成包括但不限于，时间停滞、控制肉体、熄灭或燃起火焰等效果。可指挥与自身等级相同的猩红魔女人偶“赫卡忒”作战。【被动/声骸共生】:与名为“赫卡忒”猩红魔女人偶共生，获得了不死的能力和不老的寿命，受到致命伤后也只会衰弱和沉睡，伤势会持续的恢复。');//为弗洛洛重新生成羁绊技能，使其获得了更强大的羁绊技能。
_.set('命运系统.红线对象[0]['水银灯'].身份[0]', "你的自制仿生人偶", "B级冒险者/你的自制仿生人偶");//红线对象水银灯注册成为B级冒险者，增加新身份。 
// 更新装备
_.set('财产.装备.主武器.名称[0]', '无装备', '橡木法杖');//装备了橡木法杖。
_.set('财产.装备.主武器.品质[0]', '', '优良');//装备了橡木法杖。
_.set('财产.装备.主武器.描述[0]', '', '由百年橡木树心雕琢的古朴法杖，样式修长而纤细。施法时略微增强魔法效果并略微增加施法速度。通常被拄在右手当作手杖，低调地证明你法师的身份。');//装备了橡木法杖。

// -------------------- ASSIGN --------------------
// 添加一个新任务，键为任务标题
_.assign('任务列表[0]', '剿灭哥布林', {"标题": ["剿灭哥布林", ""], "简介": ["村子东边的森林里最近出现了一窝哥布林，它们偷走了村长的宝贝酒壶。去把它们赶走，顺便把酒壶拿回来！", ""], "目标": ["消灭10只哥布林；找回村长的宝贝酒壶。", ""], "奖励": ["18铜币，50 EXP", ""]});//系统生成了新任务：“剿灭哥布林”。
// 添加一个新状态，键为状态的唯一代号
_.assign('角色.状态.即时状态[0]', '精力充沛', {"名称": ["精力充沛", ""], "效果": ["你感觉浑身是劲，体力恢复速度少量提升。", ""], "持续": ["1小时", ""]});//经过一晚优质睡眠，获得了“精力充沛”状态。
// 向背包中添加一个新物品，键为物品的唯一名称
_.assign('财产.背包[0]', '奥术长弓', {"道具名": ["奥术长弓", ""], "品质": ["稀有", ""], "数量": [1, ""], "类型": ["武器防具", ""], "描述": ["弓弦由奥术魔法构筑，拉动时汇聚奥术能量自动生成能量箭矢，无需实体箭。", ""]});//将多余的武器放入背包。
// 添加一个新技能，键为技能的唯一名称
_.assign('技能列表[0]', '强力一击', {"名称": ["强力一击", ""], "品质": ["优良", ""], "消耗": ["50 SP", ""], "描述": ["凝聚全身的力量，对目标进行一次势大力沉的攻击。虽然动作大开大合，容易被闪避，但一旦命中，就能造成远超普通攻击的伤害。评价:简单，粗暴，有效！", ""], "类型": ["主动", ""]});//被教官悉心教授技能，学会了优良品质的技能。
// 添加一个新的红线对象，键为人物的唯一名称
_.assign('命运系统.红线对象[0]', '塞莱丝汀·艾瑞隆', {"名称": ["塞莱丝汀·艾瑞隆", ""], "种族": ["翼民", ""], "等级": ["10", ""], "身份": ["翼民贵族/艾瑞隆男爵/艾瑞隆镇领主", ""], "职业": ["辉煌女神殿牧师/厨师", ""], "性格": ["温柔、善良，偶尔有些天然呆。", ""], "喜爱": ["深爱着你。喜爱烹饪美食。习惯在睡觉时用宽大柔软的翅膀把你整个包裹起来。性爱时喜欢被用力抽打大屁股。", ""], "外貌特质": ["金发及腰，眼眸如蓝宝石般清澈，背负有两对宽大的白金色羽翼，耳后上方有白金色的小巧头翅。身材高挑，性感丰腴，巨乳肥臀。气质恬静温和，总是带着治愈人心的微笑，嗓音柔和温暖。", ""], "衣物装饰": ["白金色镶边的神圣牧师长袍，白色乳贴，白金色镂空内裤，白丝吊带袜，金边白底高跟鞋。", ""], "角色装备": ["神殿牧师权杖(腰侧悬挂)", ""], "登神长阶": ["未开启", ""], "是否缔结红线": ["是", ""], "好感度": [500, ""], "评价": ["我好像爱上他了，这就是命运赐给我的礼物吗？如果能让他尝尝我做的饭就好了……", ""], "背景故事": ["翼民贵族艾瑞隆家族当代族长，自小出身高贵，肩负着家族和领主的职责与荣耀。", ""], "羁绊技能": ["【主动/奉献净化】:每日一次，为你清除不超过塞莱丝汀“生命层级”的一切临时负面状态。【被动/守护之心】:在你即将遭受致命伤害时，塞莱丝汀会无视空间距离立刻察觉，并可主动选择为你承担此次伤害。", ""]});//主动与塞莱丝汀·艾瑞隆缔结红线。
// -------------------- REMOVE --------------------
// 移除一个任务，使用任务标题作为键
_.remove('任务列表[0]', '剿灭哥布林');//“剿灭哥布林”任务已完成，奖励已领取，任务条目被移除。
// 移除一个背包物品，使用物品名作为键
_.remove('财产.背包[0]', '一封揉烂的信');//阅读后，丢弃了这封不再需要的信件。
// 移除一个即时状态，使用状态代号作为键
_.remove('角色.状态.即时状态[0]', '中毒');//使用了【解毒剂】，移除了中毒状态。
// -------------------- ADD --------------------
// 增加货币
_.add('财产.货币.银币[0]', 150);//获得150银币。
// 增加属性
_.add('角色.属性.智力[0]', 2);//喝下神话药剂【法之源泉】提供了智力属性加值，智力+2。
// 消耗背包物品
_.add("财产.背包[0]['微弱治疗药剂'].数量[0]", -1);//在战斗后使用了一瓶微弱治疗药剂，数量减1。
// 改变好感度
_.add("命运系统.红线对象[0]['葛洛莉娅·冯·瓦伦蒂亚'].好感度[0]", 5);//与葛洛莉娅·冯·瓦伦蒂亚的对话很愉快，好感度提升。
//增加经验
_.add('角色.状态.累计经验值[0]', 100);// 获得经验，可能会触发经验脚本。
</UpdateVariable>
</description>
rule:
  description:
    - 您应该在下一次回应的末尾输出更新分析，遵循在 `<status_current_variables>` 部分中定义的变量列表。
  analysis:
    - 您必须重新思考在 `<status_current_variables>` 中定义了哪些变量，并根据 `<description>` 中的规则分析如何更新它们。
    - 检查核心规则: 特别注意升级规则、物品消耗规则等。
    - 检查[禁令]
    - 连锁更新: 注意任务完成后的连锁更新（经验值、货币）和升级时的完整属性结算。
    - 使用简体中文作为 //批注 的输出。

</variable_system>