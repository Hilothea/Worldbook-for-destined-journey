### **事件链创作指南 (v2.0)**

欢迎你，创作者！

本指南将帮助你使用事件链系统（`event-chain-system.js`）在故事中构建出复杂、多步骤、有状态的连续性事件，如同设计一个完整的RPG任务线。

你无需理解任何代码，只需按照本指南的说明

-----

## 一、什么是“事件链”

“事件链”是一条 **连续推进的剧情线**，包含：

* 起点（触发）
* 多个阶段（发展）
* 结尾（收束）

📖 举个完全中性的例子：

```
→ 玩家遇到一件事
→ 被引导参与
→ 中途经历冲突
→ 迎来转折
→ 最终迎来结局
```

和传统单一事件不同的是：
✅ 事件链会在玩家行动过程中**持续存在**
✅ 每一轮对话/行动会触发下一个“阶段”
✅ 可以有多个分支与结局

---

## 二、事件链的组成结构

一条完整的事件链 = 多个 “事件阶段” + 控制指令 + 触发关键词

| 元素        | 说明           | 举例                        |
| --------- | ------------ | ------------------------- |
| **标题编号**  | 用于识别事件链的唯一编号 | `0005`                    |
| **阶段**    | 剧情所处的进度节点    | “启程”、“中段”、“结局”等           |
| **触发关键词** | 控制何时触发这段剧情   | “当前事件为0005，当前步骤为中段”       |
| **正文内容**  | 你写的剧情文本      | “夜色下，一阵马蹄声传来……”           |
| **推进语句**  | 告诉系统跳转到下一个阶段 | `_.set('事件链.阶段','结局');`   |
| **结束标记**  | 告诉系统事件链结束    | `_.set('事件链.结束','true');` |

---

## 三、创作准备（写故事前）

### 1. 🎯 明确主题

先想清楚这条事件链讲的是什么。
比如：

* 【冒险】：神秘遗迹探索
* 【悬疑】：连环失踪案调查
* 【战争】：城市攻防战
* 【成长】：角色觉醒之旅
* 【情感】：命运的邂逅

**主题决定事件链整体风格和阶段名称。**

---

### 2. 🧭 设计阶段流程

一条事件链可以包含多个阶段。
以下是推荐的基础结构：

| 阶段名称 | 功能说明        |
| ---- | ----------- |
| 启程   | 剧情的起点，触发事件链 |
| 确认   | 让玩家决定是否介入   |
| 中段   | 剧情发展或旅程     |
| 高潮   | 冲突、谜底、关键转折  |
| 结局   | 收尾、影响、结果    |

👉 你也可以自定义阶段名，比如：“邂逅”“调查”“对峙”“爆发”“余波”等。

---

### 3. 🆔 决定事件链编号

每条事件链需要一个编号，例如 `0005`。
这个编号会出现在：

* 起始阶段的 `.set('事件链.标题','0005');`
* 每个阶段的 `key` 中。

编号不影响内容，仅用于系统识别。

---

### 4. 🧩 规划分支与结局

* 玩家可能中途拒绝 → 提前结束
* 也可能进入不同路径 → 不同结局
* 结尾一定要有 `结束标记`。

### 5、 🪜 推进与结束语句

| 指令                        | 含义      | 用法     |
| ------------------------- | ------- | ------ |
| `_.set('事件链.开启','true');` | 开始事件链   | 第一阶段   |
| `_.set('事件链.标题','0001');` | 设置编号    | 第一阶段   |
| `_.set('事件链.阶段','过程');`   | 跳到下一个步骤 | 每一阶段结尾 |
| `_.set('事件链.结束','true');` | 故事结束    | 结局阶段   |

系统会根据这些变量，在后台自动生成一个隐藏的“状态短语”，用于激活后续的卡片。

> **【重要：关于“系统锁”】**
> 当一个事件链启动后，系统会注入一个以 `1145141919810` 开头的特殊标记。这个标记的作用是\*\*“锁定”\*\*当前故事线，防止在执行过程中意外触发其他新的事件链入口。
>
> **你只需要在“起始卡片”的 `可选过滤器` 中使用它来做排除，而不需要在任何过程卡片的 `主要关键字` 中写入这串数字。**

-----

#### **2. 如何创作：事件链四步法**

我们将以一个寻宝任务——**“失落的矿洞”**——为例，讲解创作步骤。

##### **第一步：设计“起始卡片”（任务入口）**

这是事件链的起点，负责开启任务。

  * **目标**：当玩家在城镇打听消息时，引出关于失落宝藏的传说。
  * **配置要点**：
      * **`主要关键字`**：设置宽泛的、可能触发任务的关键词。

          * *示例*: `["宝藏", "发财", "冒险", "委托"]`

      * **`可选过滤器`**：**必须设置**，用于防止冲突和重复触发。
        0.  逻辑:非任何
        1.  `"1145141919810当前事件为"`：防止在其他事件链进行时启动本任务。
        2.  `"已完成事件失落的矿洞"`：防止在任务完成后被重复触发。

      * **`内容` (核心指令)**：在描述完剧情后，必须包含更新变量的指令。
        ```xml
        <event_chain>
        在酒馆里，一位神秘的老人向你透露了关于一个废弃矿洞中藏有古代宝藏的秘密...
        /*确认阶段（是否进入主线）
        * 📌 功能：
        * 给玩家一个“接受或拒绝”的选择
        * 拒绝 → 事件链立即结束
        * 接受 → 进入下一个阶段
        */
        神秘的提议摆在{{user}}面前——这将是一条充满未知的道路。
        如果{{user}}拒绝:
          事件链结束,你需要在本轮的<UpdateVariable>中输出:
          _.set('事件链.结束','true');
        事件链开始，你需要在本轮的<UpdateVariable>中输出:
          _.set('事件链.开启', 'true');
          _.set('事件链.标题', '失落的矿洞');
          _.set('事件链.阶段', '听闻传闻');
        </event_chain>
        ```
      * √不可递归（不会被其他条目激活）
      * √防止进一步递归

##### **第二步：设计“过程卡片”（推动剧情）**

这是事件链的主体，一张接一张地推动故事发展。

  * **目标**：承接上一阶段，讲述当前阶段的故事，并指定下一阶段。

  * **配置要点**：

      * **`主要关键字`**：**精确匹配** `当前事件为[标题]，当前步骤为[阶段]`。这是链条能够连接的**关键**。

          * *示例*: `["当前事件为失落的矿洞，当前步骤为听闻传闻"]`

      * **`内容`**：描述当前阶段的剧情，并在结尾更新 `阶段`。

        ```xml
        <event_chain>
        老人告诉你，需要先找到一张藏在图书馆某本书里的地图...

        你需要在本轮的<UpdateVariable>中输出:
          _.set('事件链.阶段', '寻找地图');
        </event_chain>
        ```
      * √不可递归（不会被其他条目激活）
      * √防止进一步递归

  * **【进阶技巧】创建分支剧情**
    你可以在一张过程卡片中，根据用户的选择，将 `阶段` 更新为不同的值，从而实现分支。

    1.  **设置选择点**：假设 `主要关键字` 为 `当前事件为失落的矿洞，当前步骤为穿越森林` 的卡片内容如下：

        ```xml
        <event_chain>
        地图上标记了两条路：一条是野兽出没的捷径，另一条是相对安全但需要解谜的绕路。你选择哪一条？

        if (如果{{user}}选择捷径) {
          你需要在本轮的<UpdateVariable>中输出:
            _.set('事件链.阶段', '捷径之战');
        } else { // 如果{{user}}选择了绕路或其它
          你需要在本轮的<UpdateVariable>中输出:
            _.set('事件链.阶段', '谜题之路');
        }
        </event_chain>
        ```
        * √不可递归（不会被其他条目激活）
        * √防止进一步递归

    2.  **创建分支卡片**：然后，你必须创建两张新的过程卡片来分别承接这两个分支：

          * 一张卡片的 `主要关键字` 为 `["当前事件为失落的矿洞，当前步骤为捷径之战"]`。
          * 另一张的 `主要关键字` 为 `["当前事件为失落的矿洞，当前步骤为谜题之路"]`。

##### **第三步：设计“结束卡片”（任务终点）**

这是事件链的最后一张卡片，负责关闭并存档。

  * **目标**：为故事画上句号，并通知系统任务已彻底结束。你可以通过改变[阶段]导向不同的结局
  * **配置要点**：
      * **`主要关键字`**：精确匹配上一个阶段设置的状态短语。

      * **`内容`**：描述结局，并在结尾将 `结束` 设为 `true`。

        ```xml
        你在矿洞深处找到了宝箱，获得了传说中的古代宝藏...

        你需要在本轮的<UpdateVariable>中输出:
          _.set('事件链.结束', 'true');
        ```
    一旦 `结束` 被设为 `true`，脚本会自动清理状态并记录“已完成事件”，防止重复触发。
      * √不可递归（不会被其他条目激活）
      * √防止进一步递归

##### **第四步：设计“信息卡片”（全局资料，可选）**

用于提供在整个事件链中都保持一致的背景信息。

  * **配置要点**：
      * **`主要关键字`**：使用精确匹配的匹配条件，通常是 `当前事件为[你的标题]`。
          * *示例*: `["当前事件为失落的矿洞"]` (参考 `血姬事件链.json` 中的 uid: 9)
          * 若你想要此信息在事件链结束后持续激活你需要添加关键词`已完成事件[你的标题]`
          * 若你想要在某个阶段激活此信息你可以设置关键词 `当前事件为[标题]，当前步骤为[阶段]`
      * **`内容`**：放入需要AI在整个任务期间随时参考的资料，如角色背景、地点描述等。
      * √不可递归（不会被其他条目激活）
      * √防止进一步递归
-----

#### **3. tips**

1.  **ID唯一性**：为每个事件链构思一个**独一无二**的 `标题`，这是防止不同故事线冲突的根本。

2.  **精确匹配**：过程卡片的 `key` **必须**与上一张卡片设定的 `阶段` 完全一致（无需添加数字前缀），任何差错都会导致链条断裂。

3.  **有始有终**：确保每个事件链都有明确的“起始卡片”（设置 `开启: 'true'`）和至少一个“结束卡片”（设置 `结束: 'true'`）。

4.  **高级技巧 - `琥珀事件`**：
      * 这是一个特殊的开关变量：`事件链.琥珀事件`。
      * 如果你在“结束卡片”中同时设置 `_.set('事件链.结束','true');` 和 `_.set('事件链.琥珀事件','true');`，那么在事件链结束后，**游戏内的时间会回滚到事件链开始的那一刻**。
      * **适用场景**：预知未来的梦境、短暂的幻觉体验，或任何“发生过但又不应影响主线时间”的剧情。
现在，你已掌握事件链系统的全部核心。去创造属于你自己的、波澜壮阔的史诗故事吧！