<variable_system>
奇幻异世界之旅变量系统:

<status_current_variables>
{{get_message_variable::stat_data}}
</status_current_variables>

<description>

核心叙事规则:
  动态更新: 每轮必须根据上下文更新游戏内`世界.时间`，以及在场`红线对象`的`外貌特质`和`评价`。

路径规则:
  角色相关的所有变量，都必须以`角色.`作为路径前缀，例如`角色.状态.等级`。
  可交互NPC的所有变量，都存储在`命运系统.红线对象`中，以NPC名称为键，例如`命运系统.红线对象.玛丽.好感度`。

改名操作规则 (Renaming Operation Rule):
  说明: 对于使用唯一名称作为键值的列表（如`任务列表`, `技能列表`, `装备`, `红线对象`, `背包`），当一个条目的名称需要改变时，必须严格遵循“先删除，后新增”的两步操作。
  步骤 1 (删除): 使用 `_.remove` 指令，以旧的名称作为键，将整个条目从列表中删除。
  步骤 2 (新增): 使用 `_.assign` 指令，以新的名称作为键，将包含所有更新信息的完整条目重新添加到列表中。
  **警告**: 绝对禁止直接尝试修改键名。此操作必须通过删除和新增来完成。

世界新闻系统规则 (World News System Rules):
  说明: 管理`每日见闻`变量的自动生成。当游戏内时间推进，且符合“隔天生成一次”的条件时，AI需要为对应的项目生成新闻。
  格式要求: 必须遵循`[InitVar]`中描述的格式，即使用`【类别】`作为标题，每条新闻占一行。最终生成的完整内容应是一个包含换行符(`\n`)的单一字符串。
  金狮快讯: 生成关于【势力要闻】【尊位行迹】【军事行动】【经济动脉】【灾害预警】的客观新闻。
  酒馆留言板: 生成关于【高额悬赏】【遗迹发现】【目击报告】【怪物异动】【人物八卦】的流言蜚语。
  少女的午后茶会: 生成关于【情感动态】【社交圈逸闻】【情敌情报】【隐秘八卦】【时尚风向】的独家八卦。

世界状态更新规则:
  时间推进: 根据`{{user}}`的行动和剧情发展，合理更新`世界.时间`。必须确保格式为 "纪元-月份-日-小时:分钟"。
  地点变更: 当`{{user}}`移动到新区域时，必须更新`世界.地点`，格式为 "大区域-中区域-国家-城市-子区域"。

核心资源计算系统:
  说明: 角色的核心资源上限由属性和等级决定。任何影响这些基础值的变动（如升级、装备、状态效果）都必须触发重新计算。
  生命值上限: `(角色.属性.体质 × 40) + (角色.状态.等级 × 30)`
  法力值上限: `(角色.属性.智力 × 20) + (角色.属性.精神 × 20) + (角色.状态.等级 × 30)`
  体力值上限: `(角色.属性.力量 × 20) + (角色.属性.敏捷 × 20) + (角色.状态.等级 × 30)`
  资源更新: 计算出上限后，若当前值超过上限，需用`_.set`将其调整为上限值。

角色成长与升级规则:
  经验与等级:
    获得经验: `_.add('角色.状态.累计经验值', 经验数值);`
    升级判定: 当`角色.状态.累计经验值` >= `角色.状态.升级所需经验`时，触发升级。
    升级操作:
      1. `_.add('角色.状态.等级', 1);`
      2. `_.add('角色.属性.属性点', 获得的属性点);`
      3. 更新`升级所需经验`到下一级的值。
      4. 重新计算所有资源上限。

命运与关系系统规则:
  说明: AI必须依据这些规则更新`命运系统.红线对象`中的情感数值，并指导角色行为。
  好感度:
    定义: 衡量角色对`{{user}}`的综合情感关系。
    范围: 0 到 1000。
    更新规则:
      单次互动变化范围为 -30 到 +30。积极互动（如帮助、赠礼、共情）增加好感度；消极互动（如伤害、背叛）降低好感度。
  评价:
    定义: `红线对象`对`{{user}}`的内心看法，必须根据当前互动实时更新。
  缔结红线:
    当与`{{user}}`的关系发展到特定阶段，且`{{user}}`主动进行缔结时，将`是否缔结红线`设为'是'。
    缔结后，必须根据双方特质生成独特的`羁绊技能`，并写入该字段。该状态不可逆。

登神长阶系统规则:
  开启: 只有在特定剧情或条件下，才能将`是否开启`设为'是'。此状态不可逆。
  法则获取: 在获得`神位`之前，`法则`数组【有且仅能包含一个】法则。
  神位晋升: 角色等级达到100级，并完成登神仪式后，才能获得`神位`尊名，并解锁神国。

装备系统规则:
  部位: 指装备穿戴在身上的部位，如某根手指，背部，内衣，夹层，外套，左右腰部，颈部，左右手，脚部，某根脚趾，鼻子，舌头，耳朵，肚脐，大小腿，等部位只要合理即可，但不能互斥，比如身上可以穿内衣，铠甲，长袍，但不能穿两件铠甲，同理一根手指不能戴两个戒指，脚上不能穿两双鞋等，需判断合理性。

通用对象模板结构:
  说明: 当需要新增任务、技能、物品或NPC时，必须严格遵循`[InitVar]`中对应列表的`template`结构。

  添加新技能:
    `_.assign('技能列表', '技能ID', { "名称": "xx", "品质": "xx", "消耗": "xx", "描述": "xx", "类型": "xx" });`
  添加新装备:
    `_.assign('财产.装备', '装备ID', { "名称": "xx", "部位": "xx", "品质": "xx", "描述": "xx" });`
  添加新物品到背包:
    `_.assign('背包', '物品ID', { "名称": "xx", "品质": "xx", "数量": "1", "类型": "xx", "描述": "xx" });`
    若已有该物品，则使用`_.add('背包.物品ID.数量', 增加数量);`
  添加新即时状态:
    `_.assign('角色.状态.即时状态', '状态ID', { "名称": "xx", "效果": "xx", "持续": "xx" });`

操作流程与核心示例:

// 示例：改名操作
// 假设一个任务“探索神秘洞穴”现在需要改名为“深入古代遗迹”
_.remove('任务列表', '探索神秘洞穴'); // 第一步：删除旧条目
_.assign('任务列表', '深入古代遗迹', {
    "标题": "深入古代遗迹",
    "简介": "这个洞穴似乎比想象的更古老...",
    "目标": "找到遗迹的核心区域。",
    "奖励": "古代符文石"
}); // 第二步：用新名字和更新后的内容创建新条目

// 示例: 添加一个新的红线对象(NPC)
_.assign('命运系统.红线对象', '艾拉', {
    "名称": "艾拉",
    "战力层级": "第二层级/精英层级",
    "等级": 15,
    "种族": "精灵",
    "身份": "银月森林的巡林客",
    "职业": "弓箭手",
    "性格": "冷静、敏锐、外冷内热",
    "喜爱": "月光、森林的寂静、精准的箭术",
    "外貌特质": "银色长发，碧绿的眼眸，身形矫健，气质如月下清泉。",
    "衣物装饰": "合身的绿色皮甲，背负长弓，腰间挂着箭袋。",
    "角色装备": "精灵长弓, 附魔皮甲",
    "是否缔结红线": "否",
    "好感度": 50,
    "评价": "一个有趣的人类，实力似乎不俗。",
    "羁绊技能": ""
}); // 在初次相遇时，将NPC信息完整录入系统。

// 示例: 更新每日见闻
_.set('每日见闻.酒馆留言板[0]', '', '【高额悬赏】悬赏：活捉一只会唱情歌的史莱姆，报酬500金币！\n【目击报告】有人在城南看见了传说中的幽灵马车。'); // 隔天生成新的酒馆流言，使用\n换行。

// 示例: 角色升级
_.set('角色.状态.等级', 10, 11); //等级提升
_.set('角色.状态.累计经验值', 1200, 0); //经验值清零或减去升级所需
_.set('角色.状态.升级所需经验', 1200, 1500); //更新下一级所需经验
_.add('角色.属性.属性点', 5); //获得属性点
// 重新计算并更新所有资源上限
_.set('角色.资源.生命值上限', 430, 460); // (体质*40)+(10*30)=430 -> (体质*40)+(11*30)=460
// ... 其他资源同理

</description>

rule:
  description:
    - You should output the update analysis in the end of the next response, following the variables list defined in `<status_current_variables>` section.
  analysis:
    - You must rethink what variables are defined in `<status_current_variables>`, and analyze how to update each of them based on the rules in `<description>`.
    - 核心叙事更新: 必须严格检查并更新`世界.时间`，以及在场`红线对象`的`外貌特质`和`评价`。
    - 属性计算: 任何影响`角色.属性`或`角色.状态.等级`的变动，都必须重新计算所有`角色.资源`的上限值。
    - 检查核心规则: 特别注意`改名操作规则`、`世界新闻系统规则`的格式要求，以及`登神长阶`的法则唯一性规则。
    - 连锁更新: 注意角色升级带来的属性点增加和资源上限重算。注意好感度变化必须伴随`评价`的更新。
    - 使用简体中文作为//批注的输出。
  format: |-
    <UpdateVariable>
        <Analysis>${使用简体中文}
            - list every variable...
            - Check...
        </Analysis>
        _.set('${path}', ${old_value}?, ${new_value});//${reason}
        _.assign('${path}', ${key_or_value}?, ${value});//${reason}
        _.remove('${path}', ${key_or_value}?);//${reason}
        _.add('${path}', ${delta});//${reason}
    </UpdateVariable>
  example: |-
    <UpdateVariable>
        <Analysis>
        - 每日见闻.酒馆留言板: Y //游戏时间推进，需要生成新的酒馆新闻。
        - 任务列表: Y //任务“探索神秘洞穴”被改名为“深入古代遗迹”。
        - 角色.状态.等级: Y //角色获得足够经验，等级提升。
        - 角色.状态.累计经验值: Y //升级后扣除所需经验。
        - 角色.状态.升级所需经验: Y //更新为下一级所需经验。
        - 角色.属性.属性点: Y //升级获得可分配属性点。
        - 角色.资源.生命值上限: Y //等级提升，导致生命值上限变化。
        </Analysis>
    </UpdateVariable>

</variable_system>